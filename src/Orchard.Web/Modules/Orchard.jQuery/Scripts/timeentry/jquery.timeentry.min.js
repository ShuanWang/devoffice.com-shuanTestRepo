(function(n){function i(){this._disabledInputs=[];this.regional=[];this.regional[""]={show24Hours:!1,separator:":",ampmPrefix:"",ampmNames:["AM","PM"],spinnerTexts:["Now","Previous field","Next field","Increment","Decrement"]};this._defaults={appendText:"",showSeconds:!1,timeSteps:[1,1,1],initialField:0,noSeparatorEntry:!1,useMouseWheel:!0,defaultTime:null,minTime:null,maxTime:null,spinnerImage:"spinnerDefault.png",spinnerSize:[20,20,8],spinnerBigImage:"",spinnerBigSize:[40,40,16],spinnerIncDecOnly:!1,spinnerRepeat:[500,250],beforeShow:null,beforeSetTime:null};n.extend(this._defaults,this.regional[""])}function u(t,i){return t=="option"&&(i.length==0||i.length==1&&typeof i[0]=="string")?!0:n.inArray(t,r)>-1}var r,t;n.extend(i.prototype,{markerClassName:"hasTimeEntry",propertyName:"timeEntry",_appendClass:"timeEntry_append",_controlClass:"timeEntry_control",_expandClass:"timeEntry_expand",setDefaults:function(t){return n.extend(this._defaults,t||{}),this},_attachPlugin:function(i,r){var u=n(i),f;u.hasClass(this.markerClassName)||(f={options:n.extend({},this._defaults,r),input:u,_field:0,_selectedHour:0,_selectedMinute:0,_selectedSecond:0},u.data(this.propertyName,f).addClass(this.markerClassName).bind("focus."+this.propertyName,this._doFocus).bind("blur."+this.propertyName,this._doBlur).bind("click."+this.propertyName,this._doClick).bind("keydown."+this.propertyName,this._doKeyDown).bind("keypress."+this.propertyName,this._doKeyPress).bind("paste."+this.propertyName,function(){setTimeout(function(){t._parseTime(f)},1)}),this._optionPlugin(i,r))},_optionPlugin:function(t,i,r){var u,f,e,o;if(t=n(t),u=t.data(this.propertyName),!i||typeof i=="string"&&r==null)return f=i,i=(u||{}).options,i&&f?i[f]:i;t.hasClass(this.markerClassName)&&(i=i||{},typeof i=="string"&&(f=i,i={},i[f]=r),e=this._extractTime(u),n.extend(u.options,i),u._field=0,e&&this._setTime(u,new Date(0,0,0,e[0],e[1],e[2])),t.next("span."+this._appendClass).remove(),t.parent().find("span."+this._controlClass).remove(),n.fn.mousewheel&&t.unmousewheel(),o=u.options.spinnerImage?n('<span class="'+this._controlClass+'" style="display: inline-block; background: url(\''+u.options.spinnerImage+"') 0 0 no-repeat; width: "+u.options.spinnerSize[0]+"px; height: "+u.options.spinnerSize[1]+'px;"><\/span>'):null,t.after(u.options.appendText?'<span class="'+this._appendClass+'">'+u.options.appendText+"<\/span>":"").after(o||""),u.options.useMouseWheel&&n.fn.mousewheel&&t.mousewheel(this._doMouseWheel),o&&o.mousedown(this._handleSpinner).mouseup(this._endSpinner).mouseover(this._expandSpinner).mouseout(this._endSpinner).mousemove(this._describeSpinner))},_enablePlugin:function(n){this._enableDisable(n,!1)},_disablePlugin:function(n){this._enableDisable(n,!0)},_enableDisable:function(i,r){var u=n.data(i,this.propertyName);u&&(i.disabled=r,i.nextSibling&&i.nextSibling.nodeName.toLowerCase()=="span"&&t._changeSpinner(u,i.nextSibling,r?5:-1),t._disabledInputs=n.map(t._disabledInputs,function(n){return n==i?null:n}),r&&t._disabledInputs.push(i))},_isDisabledPlugin:function(t){return n.inArray(t,this._disabledInputs)>-1},_destroyPlugin:function(t){(t=n(t),t.hasClass(this.markerClassName))&&(t.removeClass(this.markerClassName).removeData(this.propertyName).unbind("."+this.propertyName),n.fn.mousewheel&&t.unmousewheel(),this._disabledInputs=n.map(this._disabledInputs,function(n){return n==t[0]?null:n}),t.siblings("."+this._appendClass+",."+this._controlClass).remove())},_setTimePlugin:function(t,i){var r=n.data(t,this.propertyName);r&&(i===null||i===""?r.input.val(""):this._setTime(r,i?typeof i=="object"?new Date(i.getTime()):i:null))},_getTimePlugin:function(t){var r=n.data(t,this.propertyName),i=r?this._extractTime(r):null;return i?new Date(0,0,0,i[0],i[1],i[2]):null},_getOffsetPlugin:function(t){var r=n.data(t,this.propertyName),i=r?this._extractTime(r):null;return i?(i[0]*3600+i[1]*60+i[2])*1e3:0},_doFocus:function(i){var r=i.nodeName&&i.nodeName.toLowerCase()=="input"?i:this,u;if(t._lastInput==r||t._isDisabledPlugin(r)){t._focussed=!1;return}u=n.data(r,t.propertyName);t._focussed=!0;t._lastInput=r;t._blurredInput=null;n.extend(u.options,n.isFunction(u.options.beforeShow)?u.options.beforeShow.apply(r,[r]):{});t._parseTime(u);setTimeout(function(){t._showField(u)},10)},_doBlur:function(){t._blurredInput=t._lastInput;t._lastInput=null},_doClick:function(i){var f=i.target,r=n.data(f,t.propertyName),c=r._field,e,u,o;if(!t._focussed)if(e=r.options.separator.length+2,r._field=0,f.selectionStart!=null){for(u=0;u<=Math.max(1,r._secondField,r._ampmField);u++)if(o=u!=r._ampmField?u*e+2:r._ampmField*e+r.options.ampmPrefix.length+r.options.ampmNames[0].length,r._field=u,f.selectionStart<o)break}else if(f.createTextRange){var h=n(i.srcElement),s=f.createTextRange(),l=function(n){return{thin:2,medium:4,thick:6}[n]||n},a=i.clientX+document.documentElement.scrollLeft-(h.offset().left+parseInt(l(h.css("border-left-width")),10))-s.offsetLeft;for(u=0;u<=Math.max(1,r._secondField,r._ampmField);u++)if(o=u!=r._ampmField?u*e+2:r._ampmField*e+r.options.ampmPrefix.length+r.options.ampmNames[0].length,s.collapse(),s.moveEnd("character",o),r._field=u,a<s.boundingWidth)break}c!=r._field&&(r._lastChr="");t._showField(r);t._focussed=!1},_doKeyDown:function(i){if(i.keyCode>=48)return!0;var r=n.data(i.target,t.propertyName);switch(i.keyCode){case 9:return i.shiftKey?t._changeField(r,-1,!0):t._changeField(r,1,!0);case 35:i.ctrlKey?t._setValue(r,""):(r._field=Math.max(1,r._secondField,r._ampmField),t._adjustField(r,0));break;case 36:i.ctrlKey?t._setTime(r):(r._field=0,t._adjustField(r,0));break;case 37:t._changeField(r,-1,!1);break;case 38:t._adjustField(r,1);break;case 39:t._changeField(r,1,!1);break;case 40:t._adjustField(r,-1);break;case 46:t._setValue(r,"");break;default:return!0}return!1},_doKeyPress:function(i){var r=String.fromCharCode(i.charCode==undefined?i.keyCode:i.charCode),u;return r<" "?!0:(u=n.data(i.target,t.propertyName),t._handleKeyPress(u,r),!1)},_doMouseWheel:function(i,r){if(!t._isDisabledPlugin(i.target)){var u=n.data(i.target,t.propertyName);u.input.focus();u.input.val()||t._parseTime(u);t._adjustField(u,r);i.preventDefault()}},_expandSpinner:function(i){var f=t._getSpinnerTarget(i),r=n.data(t._getInput(f),t.propertyName),e,u;t._isDisabledPlugin(r.input[0])||r.options.spinnerBigImage&&(r._expanded=!0,e=n(f).offset(),u=null,n(f).parents().each(function(){var t=n(this);return(t.css("position")=="relative"||t.css("position")=="absolute")&&(u=t.offset()),!u}),n('<div class="'+t._expandClass+'" style="position: absolute; left: '+(e.left-(r.options.spinnerBigSize[0]-r.options.spinnerSize[0])/2-(u?u.left:0))+"px; top: "+(e.top-(r.options.spinnerBigSize[1]-r.options.spinnerSize[1])/2-(u?u.top:0))+"px; width: "+r.options.spinnerBigSize[0]+"px; height: "+r.options.spinnerBigSize[1]+"px; background: transparent url("+r.options.spinnerBigImage+') no-repeat 0px 0px; z-index: 10;"><\/div>').mousedown(t._handleSpinner).mouseup(t._endSpinner).mouseout(t._endExpand).mousemove(t._describeSpinner).insertAfter(f))},_getInput:function(i){return n(i).siblings("."+t.markerClassName)[0]},_describeSpinner:function(i){var r=t._getSpinnerTarget(i),u=n.data(t._getInput(r),t.propertyName);r.title=u.options.spinnerTexts[t._getSpinnerRegion(u,i)]},_handleSpinner:function(i){var e=t._getSpinnerTarget(i),u=t._getInput(e),r,f;if(!t._isDisabledPlugin(u)&&(u==t._blurredInput&&(t._lastInput=u,t._blurredInput=null),r=n.data(u,t.propertyName),t._doFocus(u),f=t._getSpinnerRegion(r,i),t._changeSpinner(r,e,f),t._actionSpinner(r,f),t._timer=null,t._handlingSpinner=!0,f>=3&&r.options.spinnerRepeat[0])){t._timer=setTimeout(function(){t._repeatSpinner(r,f)},r.options.spinnerRepeat[0]);n(e).one("mouseout",t._releaseSpinner).one("mouseup",t._releaseSpinner)}},_actionSpinner:function(n,i){n.input.val()||t._parseTime(n);switch(i){case 0:this._setTime(n);break;case 1:this._changeField(n,-1,!1);break;case 2:this._changeField(n,1,!1);break;case 3:this._adjustField(n,1);break;case 4:this._adjustField(n,-1)}},_repeatSpinner:function(n,i){t._timer&&(t._lastInput=t._blurredInput,this._actionSpinner(n,i),this._timer=setTimeout(function(){t._repeatSpinner(n,i)},n.options.spinnerRepeat[1]))},_releaseSpinner:function(){clearTimeout(t._timer);t._timer=null},_endExpand:function(i){t._timer=null;var r=t._getSpinnerTarget(i),u=t._getInput(r),f=n.data(u,t.propertyName);n(r).remove();f._expanded=!1},_endSpinner:function(i){t._timer=null;var r=t._getSpinnerTarget(i),u=t._getInput(r),f=n.data(u,t.propertyName);t._isDisabledPlugin(u)||t._changeSpinner(f,r,-1);t._handlingSpinner&&(t._lastInput=t._blurredInput);t._lastInput&&t._handlingSpinner&&t._showField(f);t._handlingSpinner=!1},_getSpinnerTarget:function(n){return n.target||n.srcElement},_getSpinnerRegion:function(t,i){var l=this._getSpinnerTarget(i),s=n(l).offset(),h=[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop],u=t.options.spinnerIncDecOnly?99:i.clientX+h[0]-s.left,f=i.clientY+h[1]-s.top,r=t.options[t._expanded?"spinnerBigSize":"spinnerSize"],o=t.options.spinnerIncDecOnly?99:r[0]-1-u,c=r[1]-1-f,e;return r[2]>0&&Math.abs(u-o)<=r[2]&&Math.abs(f-c)<=r[2]?0:(e=Math.min(u,f,o,c),e==u?1:e==o?2:e==f?3:4)},_changeSpinner:function(t,i,r){n(i).css("background-position","-"+(r+1)*t.options[t._expanded?"spinnerBigSize":"spinnerSize"][0]+"px 0px")},_parseTime:function(n){var t=this._extractTime(n),i;t?(n._selectedHour=t[0],n._selectedMinute=t[1],n._selectedSecond=t[2]):(i=this._constrainTime(n),n._selectedHour=i[0],n._selectedMinute=i[1],n._selectedSecond=n.options.showSeconds?i[2]:0);n._secondField=n.options.showSeconds?2:-1;n._ampmField=n.options.show24Hours?-1:n.options.showSeconds?3:2;n._lastChr="";n._field=Math.max(0,Math.min(Math.max(1,n._secondField,n._ampmField),n.options.initialField));n.input.val()!=""&&this._showTime(n)},_extractTime:function(n,t){var i,u,f;if(t=t||n.input.val(),i=t.split(n.options.separator),n.options.separator==""&&t!=""&&(i[0]=t.substring(0,2),i[1]=t.substring(2,4),i[2]=t.substring(4,6)),i.length>=2){var o=!n.options.show24Hours&&t.indexOf(n.options.ampmNames[0])>-1,e=!n.options.show24Hours&&t.indexOf(n.options.ampmNames[1])>-1,r=parseInt(i[0],10);return r=isNaN(r)?0:r,r=((o||e)&&r==12?0:r)+(e?12:0),u=parseInt(i[1],10),u=isNaN(u)?0:u,f=i.length>=3?parseInt(i[2],10):0,f=isNaN(f)||!n.options.showSeconds?0:f,this._constrainTime(n,[r,u,f])}return null},_constrainTime:function(n,t){var f=t!=null,r,u,i;for(f||(r=this._determineTime(n.options.defaultTime,n)||new Date,t=[r.getHours(),r.getMinutes(),r.getSeconds()]),u=!1,i=0;i<n.options.timeSteps.length;i++)u?t[i]=0:n.options.timeSteps[i]>1&&(t[i]=Math.round(t[i]/n.options.timeSteps[i])*n.options.timeSteps[i],u=!0);return t},_showTime:function(n){var t=this._formatNumber(n.options.show24Hours?n._selectedHour:(n._selectedHour+11)%12+1)+n.options.separator+this._formatNumber(n._selectedMinute)+(n.options.showSeconds?n.options.separator+this._formatNumber(n._selectedSecond):"")+(n.options.show24Hours?"":n.options.ampmPrefix+n.options.ampmNames[n._selectedHour<12?0:1]);this._setValue(n,t);this._showField(n)},_showField:function(n){var i=n.input[0],r;if(!n.input.is(":hidden")&&t._lastInput==i){var f=n.options.separator.length+2,u=n._field!=n._ampmField?n._field*f:n._ampmField*f-n.options.separator.length+n.options.ampmPrefix.length,e=u+(n._field!=n._ampmField?2:n.options.ampmNames[0].length);i.setSelectionRange?i.setSelectionRange(u,e):i.createTextRange&&(r=i.createTextRange(),r.moveStart("character",u),r.moveEnd("character",e-n.input.val().length),r.select());i.disabled||i.focus()}},_formatNumber:function(n){return(n<10?"0":"")+n},_setValue:function(n,t){t!=n.input.val()&&n.input.val(t).trigger("change")},_changeField:function(n,t,i){var r=n.input.val()==""||n._field==(t==-1?0:Math.max(1,n._secondField,n._ampmField));return r||(n._field+=t),this._showField(n),n._lastChr="",r&&i},_adjustField:function(n,t){n.input.val()==""&&(t=0);this._setTime(n,new Date(0,0,0,n._selectedHour+(n._field==0?t*n.options.timeSteps[0]:0)+(n._field==n._ampmField?t*12:0),n._selectedMinute+(n._field==1?t*n.options.timeSteps[1]:0),n._selectedSecond+(n._field==n._secondField?t*n.options.timeSteps[2]:0)))},_setTime:function(t,i){var f;i=this._determineTime(i,t);f=this._constrainTime(t,i?[i.getHours(),i.getMinutes(),i.getSeconds()]:null);i=new Date(0,0,0,f[0],f[1],f[2]);var i=this._normaliseTime(i),r=this._normaliseTime(this._determineTime(t.options.minTime,t)),u=this._normaliseTime(this._determineTime(t.options.maxTime,t));r&&u&&r>u?i<r&&i>u&&(i=Math.abs(i-r)<Math.abs(i-u)?r:u):i=r&&i<r?r:u&&i>u?u:i;n.isFunction(t.options.beforeSetTime)&&(i=t.options.beforeSetTime.apply(t.input[0],[this._getTimePlugin(t.input[0]),i,r,u]));t._selectedHour=i.getHours();t._selectedMinute=i.getMinutes();t._selectedSecond=i.getSeconds();this._showTime(t)},_determineTime:function(n,i){var r=function(n){var t=new Date;return t.setTime(t.getTime()+n*1e3),t},u=function(n){var u=t._extractTime(i,n),r=new Date,o=u?u[0]:r.getHours(),s=u?u[1]:r.getMinutes(),h=u?u[2]:r.getSeconds(),e,f;if(!u)for(e=/([+-]?[0-9]+)\s*(s|S|m|M|h|H)?/g,f=e.exec(n);f;){switch(f[2]||"s"){case"s":case"S":h+=parseInt(f[1],10);break;case"m":case"M":s+=parseInt(f[1],10);break;case"h":case"H":o+=parseInt(f[1],10)}f=e.exec(n)}return r=new Date(0,0,10,o,s,h,0),/^!/.test(n)&&(r.getDate()>10?r=new Date(0,0,10,23,59,59):r.getDate()<10&&(r=new Date(0,0,10,0,0,0))),r};return n?typeof n=="string"?u(n):typeof n=="number"?r(n):n:null},_normaliseTime:function(n){return n?(n.setFullYear(1900),n.setMonth(0),n.setDate(0),n):null},_handleKeyPress:function(n,t){var f;if(t==n.options.separator)this._changeField(n,1,!1);else if(t>="0"&&t<="9"){var r=parseInt(t,10),i=parseInt(n._lastChr+t,10),e=n._field!=0?n._selectedHour:n.options.show24Hours?i<24?i:r:(i>=1&&i<=12?i:r>0?r:n._selectedHour)%12+(n._selectedHour>=12?12:0),o=n._field!=1?n._selectedMinute:i<60?i:r,s=n._field!=n._secondField?n._selectedSecond:i<60?i:r,u=this._constrainTime(n,[e,o,s]);this._setTime(n,new Date(0,0,0,u[0],u[1],u[2]));n.options.noSeparatorEntry&&n._lastChr?this._changeField(n,1,!1):n._lastChr=t}else n.options.show24Hours||(t=t.toLowerCase(),(t==n.options.ampmNames[0].substring(0,1).toLowerCase()&&n._selectedHour>=12||t==n.options.ampmNames[1].substring(0,1).toLowerCase()&&n._selectedHour<12)&&(f=n._field,n._field=n._ampmField,this._adjustField(n,1),n._field=f,this._showField(n)))}});r=["getOffset","getTime","isDisabled"];n.fn.timeEntry=function(i){var r=Array.prototype.slice.call(arguments,1);return u(i,r)?t["_"+i+"Plugin"].apply(t,[this[0]].concat(r)):this.each(function(){if(typeof i=="string"){if(!t["_"+i+"Plugin"])throw"Unknown command: "+i;t["_"+i+"Plugin"].apply(t,[this].concat(r))}else{var u=n.fn.metadata?n(this).metadata():{};t._attachPlugin(this,n.extend({},u,i||{}))}})};t=n.timeEntry=new i})(jQuery);
//# sourceMappingURL=jquery.timeentry.min.js.map
